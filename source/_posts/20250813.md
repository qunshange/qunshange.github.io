---
title: Vue/Uni-App 多选标签接口对接与交互实现
date: 2025-08-13
excerpt: 实习学习经验
tag: 
- 实际项目开发总结
- axios
category:
- 前端
- 微信小程序
---
## Uni-App 多选标签组件实战：补贴品类的获取、渲染与选中保存

动态获取数据并生成可交互的多选标签，用 **Vue/Uni-App + axios** 从后端获取数据，循环渲染，并实现选中状态切换与保存。

---

### 一、功能需求分析

1. **接口数据获取**
   从后端接口(公司提供)获取补贴品类表列。

2. **循环渲染**
   用 `v-for` 将接口返回的品类渲染成可点击的标签按钮。

3. **选中交互**
   点击标签时切换选中状态，并保存到数组，供后续提交表单使用。

4. **扩展优化**

   * 多选状态样式高亮
   * 选中逻辑避免重复 ID
   * 数据与 UI 双向绑定

---

### 二、接口对接（axios 请求）

首先，我们在页面内创建一个 axios 实例，并发起请求获取补贴品类数据。

```js
import axios from 'axios'

const http = axios.create({
  baseURL: HTTP_REQUEST_URL,
  timeout: 15000,
})

http.interceptors.response.use(r => r.data, e => {
  uni.showToast({ title: '网络异常', icon: 'none' })
  return Promise.reject(e)
})
```

---

### 三、获取数据并加工

在组件的 `data` 中存放 `List`（用于渲染）和 `new_ids`（用于保存选中的 ID）。

```js
export default {
  data() {
    return {
      List: [], // { id, name, checked }
      new_ids: [],  // 存储已选中item的ID
    }
  },
  mounted() {
    this.getList()
  },
  methods: {
    async getList() {
      try {
        const res = await http.get('/request')
        if (res?.status === 200) {
          // 给每项添加 checked 字段
          this.categoryList = (res.data || []).map(it => ({
            ...it,
            checked: false
          }))
        } else {
          uni.showToast({ title: '获取item失败', icon: 'none' })
        }
      } catch (e) {
        console.error(e)
        uni.showToast({ title: '网络请求失败', icon: 'none' })
      }
    }
  }
}
```

---

### 四、循环渲染标签

使用 `v-for` 循环输出标签，并根据 `checked` 字段动态添加 `active` 样式。

```html
<view class="checkgroup">
  <view
    class="check-item"
    v-for="(item, index) in getList"
    :key="item.id"
    :class="{ active: item.checked }"
    @click="toggle(index)"
  >
    {{ item.name }}
  </view>
</view>
```

---

### 五、点击切换与保存选中 ID

```js
methods: {
  toggle(index) {
    const item = this.List[index]
    item.checked = !item.checked

    // 用 Set 去重
    const set = new Set(this.new_ids)
    item.checked ? set.add(item.id) : set.delete(item.id) // true代表刚刚选中,加入其中
    // 把set转为数组重新赋值给new_ids
    this.new_ids = Array.from(set)

    // 确保响应式,同步更新到页面上
    this.$set(this.getList, index, item)
  }
}
```

这样，`new_ids` 中始终存放当前选中item的ID，后续提交表单时可以直接使用。

---

### 六、样式

```scss
.checkgroup {
  //flex布局
  display: flex;
  padding: 30rpx 0;
  flex-wrap: wrap;
  justify-content: space-between;
  align-content: space-between;
}
.check-item {
  //省略

  &.active {
   //选中后的样式改变
  }
}
```

---

### 七、gpt给出的优化建议(待实现)

1. **选中状态持久化**
   可以将 `new_ids` 存到 `localStorage` 或 Vuex，在页面切换时保持状态。

2. **支持单选/多选切换**
   如果未来有单选需求，可以通过参数控制 `toggle` 方法。

3. **无数据时的占位提示**
   接口返回空数组时，显示“暂无可选品类”的提示。

---

### 八、效果预览

> 效果示例：
>
> * 初始加载时，标签灰色背景
> * 点击后，标签变为红底白字
> * 选中项 ID 会同步存到 `new_ids`

---
